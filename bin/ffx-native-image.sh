#! /bin/bash

export NATIVE_FLAGS="-H:+PrintClassInitialization -H:+ReportExceptionStackTraces -H:TraceClassInitialization=true"

# export INIT_BUILD=""
export INIT_BUILD="--initialize-at-build-time=org.codehaus.groovy.vmplugin.v16.Java16,org.codehaus.groovy.util.LazyReference,org.codehaus.groovy.reflection.stdclasses.IntegerCachedClass,org.codehaus.groovy.runtime.GroovyCategorySupport,org.codehaus.groovy.util.ReferenceBundle,org.codehaus.groovy.reflection.CachedClass$5,org.apache.groovy.plugin.GroovyRunnerRegistry,org.codehaus.groovy.reflection.ClassInfo,org.codehaus.groovy.reflection.CachedClass$8,org.codehaus.groovy.reflection.stdclasses.BooleanCachedClass,org.codehaus.groovy.vmplugin.VMPluginFactory,org.codehaus.groovy.runtime.dgmimpl.arrays.ByteArrayGetAtMetaMethod,org.codehaus.groovy.reflection.CachedClass$3,org.codehaus.groovy.runtime.dgmimpl.arrays.ByteArrayPutAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.CharacterArrayPutAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.ArrayGetAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.CachedSAMClass,org.codehaus.groovy.runtime.dgmimpl.NumberNumberMetaMethod,java.beans.ThreadGroupContext,org.codehaus.groovy.reflection.CachedClass$4,org.codehaus.groovy.reflection.stdclasses.ObjectCachedClass,org.codehaus.groovy.runtime.dgmimpl.arrays.FloatArrayPutAtMetaMethod,com.sun.beans.introspect.ClassInfo,org.codehaus.groovy.runtime.dgmimpl.arrays.FloatArrayGetAtMetaMethod,org.codehaus.groovy.reflection.CachedClass,org.codehaus.groovy.reflection.GroovyClassValueFactory,org.codehaus.groovy.runtime.dgmimpl.NumberNumberMinus,org.codehaus.groovy.vmplugin.v8.CacheableCallSite,org.codehaus.groovy.runtime.dgmimpl.arrays.ShortArrayGetAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.ArrayMetaMethod,groovy.lang.MetaClassImpl,org.codehaus.groovy.reflection.stdclasses.DoubleCachedClass,org.codehaus.groovy.reflection.ReflectionUtils,org.codehaus.groovy.runtime.dgmimpl.arrays.LongArrayPutAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.StringCachedClass,org.codehaus.groovy.runtime.DefaultGroovyMethodsSupport,org.codehaus.groovy.runtime.dgmimpl.arrays.DoubleArrayPutAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.BooleanArrayGetAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.ArrayCachedClass,groovy.lang.GroovySystem,org.codehaus.groovy.runtime.dgmimpl.arrays.DoubleArrayGetAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.ObjectArrayGetAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.NumberNumberPlus,org.codehaus.groovy.runtime.dgmimpl.arrays.ShortArrayPutAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.CachedClosureClass,org.codehaus.groovy.reflection.stdclasses.CharacterCachedClass,com.sun.beans.TypeResolver,org.codehaus.groovy.reflection.stdclasses.BigDecimalCachedClass,org.codehaus.groovy.runtime.dgmimpl.arrays.ArrayPutAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.BooleanArrayPutAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.LongCachedClass,org.codehaus.groovy.runtime.m12n.MetaInfExtensionModule,org.codehaus.groovy.vmplugin.v8.Java8,org.codehaus.groovy.runtime.DefaultGroovyMethods,org.codehaus.groovy.runtime.dgmimpl.arrays.IntegerArrayPutAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.FloatCachedClass,org.codehaus.groovy.reflection.CachedClass$7,org.codehaus.groovy.reflection.CachedClass$1,org.codehaus.groovy.runtime.dgmimpl.NumberNumberMultiply,org.codehaus.groovy.runtime.dgmimpl.arrays.CharacterArrayGetAtMetaMethod,org.codehaus.groovy.reflection.ClassInfo$LazyCachedClassRef,org.codehaus.groovy.reflection.ReflectionCache,org.codehaus.groovy.runtime.dgmimpl.arrays.ObjectArrayPutAtMetaMethod,org.codehaus.groovy.runtime.MetaClassHelper,org.codehaus.groovy.reflection.ClassInfo$LazyClassLoaderRef,org.codehaus.groovy.runtime.dgmimpl.NumberNumberDiv,java.beans.Introspector,org.codehaus.groovy.runtime.m12n.SimpleExtensionModule,org.codehaus.groovy.reflection.CachedClass$6,org.codehaus.groovy.runtime.dgmimpl.arrays.IntegerArrayGetAtMetaMethod,org.codehaus.groovy.runtime.dgmimpl.arrays.LongArrayGetAtMetaMethod,org.codehaus.groovy.reflection.stdclasses.BigIntegerCachedClass,org.codehaus.groovy.reflection.stdclasses.NumberCachedClass,org.codehaus.groovy.reflection.CachedClass$2"

export INIT_RUN="--initialize-at-run-time=ffx.potential.bonded.RendererCache,org.jogamp.java3d.SoundRetained,org.jogamp.java3d.Screen3D,org.jogamp.java3d.VirtualUniverse,org.jogamp.java3d.Canvas3D,edu.uiowa.jopenmm.OpenMMAmoebaLibrary,edu.uiowa.jopenmm.OpenMMLibrary"

export EXTRA_FLAGS="--trace-object-instantiation=org.codehaus.groovy.vmplugin.v8.IndyInterface"

native-image $NATIVE_FLAGS $INIT_BUILD $INIT_RUN $EXTRA_FLAGS --report-unsupported-elements-at-runtime --no-fallback -cp ".:ffx-all-1.0.0-beta.jar" ffx.Main

